---
title: 论文-GFS（Google File System）
date: 2024-07-26 09:54:48
tags: [GFS, 分布式, 集群, 网络通信]
categories: 技术研究
cover:
top_img:
---

# 论文-GFS（Google File System）

> [论文链接](https://pdos.csail.mit.edu/6.824/papers/vm-ft.pdf)

Google文件系统是一个用于大型分布式数据密集型应用程序的可拓展分布式文件系统。分布式文件系统是一种文件系统架构，用于在网络中多个服务器和存储设备之间共享文件和数据。主要目标是允许用户远程访问存储在多个不同地理位置的服务器上的数据，就像这些文件存储在本地计算机上一样。分布式文件系统支持文件的存储和管理，使得文件能够跨多个物理存储设备分散存储，同时为用户提供统一连贯的访问接口。所追求的目标在于性能、可拓展性、可靠性、可用性。

`GFS`提供一些熟悉的文件系统接口，文件在目录中层次化组织，并由路径名进行标识，包括支持创建、删除、打开、关闭、读取和写入文件的常规操作。

`GFS`还有快照和记录追加操作，快照以低成本创建文件或者目录树的副本，记录追加允许多个客户端同时向同一个文件追加数据，同时保证每个客户端追加的原子性，许多客户端可以同时追加数据而无需额外的锁定。

## 架构

`GFS`集群由一个主控和多个块服务器组成，并由多个客户端访问，集群中的节点通常是运行用户级服务器进程的普通`linux`机器。文件被分割成固定大小的块，每个块由`master`在块创建时分配的不可变且全局唯一的64位块句柄标识。块服务器将块存储在本地磁盘上作为`linux`文件，并按块句柄和字节范围读取或者写入块数据。通常为了可靠性，会保存多个副本。

`master`维护所有文件系统元数据。这包括命名空间、访问控制信息、从文件到块的映射以及块的当前位置信息。它还控制系统范围的活动，如块租约管理、孤立块的垃圾回收和块服务器之间的块迁移。`master`定期通过心跳消息与每个块服务器通信，向其发送指令并收集其状态。

链接到每个应用程序的`GFS`客户端代码实现文件系统`API`，并与`master`和块服务器通信以代表应用程序读写数据。客户端与`master`交互以进行元数据操作，但所有数据承载的通信都直接与块服务器进行。

![gfs-01](paper-gfs/gfs-01.png)

假设我们一个客户端想要读取`GFS`中的内容，首先会使用固定的块大小，将应用程序指定的文件名和字节偏移量转化为文件中的块索引，然后向`master`发送包含文件名和块索引的请求，`master`会恢复相应的句柄和副本的位置。客户端随后便会向其中的一个副本发送请求，通常时最近的副本。请求指定块句柄和该块内的字节范围。进一步读取相同块不需要更多的客户端-主控交互，直到缓存信息过期或文件重新打开。

## 块大小

在`GFS`中采用了`64MB`作为文件系统中的块大小，这实际上是一个比较打的文件系统块，很显然，我们的数据是存储在块服务器上的，如果我们仅仅是需要写入或者访问小文件的话，那么块内会存在比较大的内部碎片。

当然论文中也给出了使用大块的优势：首先，它减少了客户端与主控交互的需求，因为对同一块的读取和写入只需要一次向主控请求块位置信息。对于工作负载，这种减少尤其显著，因为应用程序主要顺序读取和写入大文件。即使对于小的随机读取，客户端也可以舒适地缓存多`TB`工作集的所有块位置信息。其次，由于在一个大块上，客户端更有可能在给定块上执行许多操作，它可以通过在一段时间内保持与块服务器的持久`TCP`连接来减少网络开销。第三，它减少了主控存储的元数据量。这允许我们将元数据保存在内存中，在内存中运行速度其实就会快很多。